#!/bin/bash

if [[ $1 = "INSTANCE" ]] && [[ $2 = "{{ keepalived["instance_name"] }}" ]] && [[ $4 = "{{ keepalived["id"] }}" ]]; then

  if [[ $3 = "MASTER" ]]; then

    ip link add isp1macvlan link isp1 address {{ keepalived["notify"]["isp1"]["mac"] }} type macvlan mode bridge
    ip link add isp1macvlan link isp2 address {{ keepalived["notify"]["isp2"]["mac"] }} type macvlan mode bridge
    systemctl restart systemd-networkd

  else

    ip link del isp1macvlan
    ip link del isp2macvlan

  fi

fi
