#!/bin/bash

if [[ $3 = "MASTER" ]]; then

  # isp1
  ip link add link management name isp1 address {{ keepalived["notify"]["isp1"]["mac"] }} type vlan id 121
  ip a add {{ keepalived["notify"]["isp1"]["address"] }}/{{ keepalived["notify"]["isp1"]["network"] }} dev isp1
  ip link set dev isp1 up
  ip ro add default via {{ keepalived["notify"]["isp1"]["gateway"] }} dev isp1 metric 50   

  # nftables
  nft -f /etc/keepalived/append.nft

else

  # nftables
  nft -f /etc/nftables.conf

  # interfaces
  ip link del dev isp1

fi
