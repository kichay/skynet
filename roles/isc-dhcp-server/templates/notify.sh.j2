#!/bin/bash

LEASES=/var/lib/dhcp/dhcpd.leases
TIMEOUT=5

if [[ $1 = "schedule" ]]; then

  /bin/bash -c "sleep $TIMEOUT; $0 push" &

fi

if [[ $1 = "pull" ]]; then

  etcdctl get dhcpd.leases 1>$LEASES 2>/dev/null || true

fi

if [[ $1 = "push" ]]; then

  etcdctl mk dhcpd.leases "$(cat $LEASES)" 1>/dev/null 2>/dev/null || etcdctl update dhcpd.leases "$(cat $LEASES)"  1>/dev/null 2>/dev/null

fi
