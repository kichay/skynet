#!/usr/sbin/nft -f

flush ruleset

table inet filter {
	chain input {

		type filter hook input priority 0
		policy drop;
    	ct state established,related accept
	    iifname lo accept
	    iifname skynet accept
    	icmp type echo-request accept
    	tcp dport {ssh, http, https} iif isp1 accept
    	tcp dport {ssh, http, https} iif isp2 accept
    	tcp dport {ssh} iif management accept

	}
	chain forward {

		type filter hook forward priority 0
		policy drop
		iifname skynet accept
		iifname home oifname isp1 accept
		iifname home oifname isp2 accept

	}
	chain output {

		type filter hook output priority 0
		policy accept

	}
}

table ip nat {
	chain prerouting {
		type nat hook prerouting priority 0
		policy drop
		iifname home oifname isp1 accept
		iifname home oifname isp2 accept
		iifname skynet accept
	}

	chain postrouting {
		type nat hook postrouting priority 100
		policy drop
		oifname isp1 masquerade
		oifname isp2 masquerade
	}
}
