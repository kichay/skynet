#!/usr/sbin/nft -f

flush ruleset

table bridge filter {

    # 5.130.78.89 = 0x05824e59

    chain input {

        type filter hook input priority -200; policy accept;
        oifname novotelecom ip daddr 5.130.78.89 accept
        oifname novotelecom ether type arp arp ptype 0x0800 arp htype 1 arp hlen 6 arp plen 4 @nh,192,32 0x05824e59 accept
        oifname novotelecom drop

    }

    chain output {

        type filter hook output priority -200; policy accept;
        iifname novotelecom ip saddr 5.130.78.89 accept
        iifname novotelecom ether type arp arp ptype 0x0800 arp htype 1 arp hlen 6 arp plen 4 @nh,112,32 0x05824e59 accept
        iifname novotelecom drop

    }

}

table inet filter {

    chain input {

        type filter hook input priority 0; policy drop;
        ct state { established, related } accept
        iifname { lo, skynet } accept
        iifname home tcp dport 53 accept
        iifname home udp dport 53 accept
        tcp dport ssh accept
        icmp type echo-request accept

    }

    chain forward {

        type filter hook forward priority 0; policy accept;
        ct state established,related accept
        # iifname home oifname != novotelecom drop

    }

    chain prerouting {

        type nat hook prerouting priority -100; policy accept;
        ip daddr 5.130.78.89 tcp dport { 80, 443 } dnat ip to 192.168.128.14

    }

    chain postrouting {

        type nat hook postrouting priority 100; policy accept;
        oifname novotelecom masquerade

    }

}
